<!DOCTYPE html> 
<!-- ! LOOK HERE IF YOU ENTERED A LEVEL ON STARTUP-->
<!-- ! LOOK AROUND LINE 300 TO CHECK THAT GSETUP() IS IN PLACE-->
<html lang="en"> 
  <head>
    <title>Maze Runner</title> 
    <style>
      @charset "utf-8";
      /* CSS Document */
      html,
      html {
        background-color: #383837;
        font-family: Arial, Helvetica, sans-serif;
      }
      #Code {
        position: relative;
        top: 0;
        right: 0;
        width: 60%;
        height: 100%;
        background-color: #383837;
        color: #fff;
        overflow: auto;
        z-index: 100;
      }
    </style>
  </head>
  <body>
    <canvas id="mycanvas"></canvas> 
    <div id="Code">
      <div id="text"
        <h1 id="head">Source Code</h1>
        <p>Embed script done by <a href="https://EmGithub.com">EmGithub.com</a></p>
      </div>
      <div id="embed">
        <pre>
          <code>
            <script id="embd" src="https://emgithub.com/embed-v2.js?target=https%3A%2F%2Fgithub.com%2FIvanButBetter%2FMazeRunner%2Fblob%2Fmain%2FGame.html&style=atom-one-dark&type=code&showLineNumbers=on&showFullPath=on&showCopy=on"></script>
          </code>
        </pre>
      </div>
    </div>

  </body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/processing.js/1.4.8/processing.js"></script> 
  <script>
     function programCode(processingInstance) {
      with (processingInstance) {
        size(800, 800); 
        frameRate(60);
        img = loadImage("characterLarge.png");

        // Certain Debugging things
        PFont.list(); {
          console.log("Font List:", PFont.list())
        }

      // Variables
        var scene = 0;
        var health = 1;
        var timer = 10;
        var initTimer = 0;
        var isPlaying = false;
        var img;
        var difficulty = normal
        // Buttons
        var b1 = {
          x: 300,
          y: 650,
          width: 150,
          height: 75,
          rounding: 10,
          fill: 166,
          textSize: 30,
          text: "Start"
        }
        var b2 = {
          x: 300,
          y: 650,
          width: 150,
          height: 75,
          rounding: 10,
          fill: 254,
          textSize: 30,
          text: "Try Again"
        }
        var b3 = {
          x: 600,
          y: 650,
          width: 150,
          height: 75,
          rounding: 10,
          fill: 254,
          textSize: 28,
          text: "Title Screen"
        }
        var b99 = {
          x: 600,
          y: 650,
          width: 150,
          height: 75,
          rounding: 10,
          fill: 166,
          textSize: 20,
          text: "Difficulty Select"
        }
        var b5 = {
          x: 100,
          y: 600,
          width: 150,
          height: 75,
          rounding: 10,
          fill: 255,
          textSize: 30,
          text: "Easy"
        }
        var b6 = {
          x: 350,
          y: 600,
          width: 150,
          height: 75,
          rounding: 10,
          fill: 255,
          textSize: 30,
          text: "Normal"
        }
        var b7 = {
          x: 600,
          y: 600,
          width: 150,
          height: 75,
          rounding: 10,
          fill: 255,
          textSize: 30,
          text: "Hard"

        }
        // Function to draw buttons
        function btnGen(btn) { 
            fill(btn.fill);
            rect(btn.x, btn.y, btn.width, btn.height, btn.rounding);
            textSize(btn.textSize);
            fill(0);
            textAlign(CENTER, CENTER);
            text(btn.text, btn.x + btn.width / 2, btn.y + btn.height / 2);
        };
        // Generating Level Objects
        function walls(wall) {
          fill(16, 16, 16);
          noStroke();
          rect(wall.x, wall.y, wall.width, wall.height, wall.rounding);
        };
        function winbox(win) {
          fill(30, 188, 30);
          rect(win.x, win.y, win.width, win.height, win.rounding);
        };
        // Non-game scenes at the beginning
        function GSetup() {
          scene = 1;
          background(60);
          fill(255, 255, 255);
          textSize(75);
          text("Maze Runner", 200, 400);
          textSize(45);
          text("Click anywhere to start", 225, 500);
          mouseClicked = function() {
            tutorial()
          }
        };
        function tutorial() {
          scene = 2;
          console.log(scene)
          textAlign(LEFT, TOP);
          background(60);
          fill(255);
          textSize(75);
          text("How to Play", 50, 100);
          textSize(35);
          text("Your character follows your mouse", 50, 200);
          text("Do not hit the black walls", 50, 250);
          text("Do not stand still, the incoming walls will kill you!", 50, 300);
          textSize(75);
          text("Objective", 50, 420);
          textSize(35);
          text("With your mouse, guide the boy to the end of the maze.", 50, 500, 600, 700);
          btnGen(b1);
          btnGen(b99);
          textSize(20);
          text("(Default Difficulty is Normal)", 665, 750)
          mouseClicked = function() {
            if (MCC(b1)) {
              level1();
              isPlaying = true;
            } if (MCC(b99)) {
              DifficultySelect();
            }
          }
        };
        function DifficultySelect() {
          textAlign(LEFT, TOP)
          scene = scene + 777
          background(60)
          fill(255)
          textSize(75)
          text("Difficulty Selection", 50, 100)
          textSize(35)
          text("Difficulty is based on the timer.", 10, 200)
          textSize(20)
          text("Hard makes the timer actually have consequences. Intended for experienced players.", 10, 250)
          text("Normal is the default value. Gives you time to make mistakes. This is the default", 10, 300)
          text("Easy is for those who want to take the game slowly without having to worry about time.", 10, 350)
          btnGen(b5);
          btnGen(b6);
          btnGen(b7);
          mouseClicked = function() {
            if (MCC(b5)) {
              timer = timer + 25;
              initTimer = 35;
              tutorial()
          //    isPlaying = true;
            } if (MCC(b6)) {
              tutorial()
              initTimer = 10;
          //    isPlaying = true;
            } if (MCC(b7)) {
              timer = timer - 5;
              initTimer = 5;
              tutorial()
          //    isPlaying = true;
            }
          }
        }
        //Button input checks
        function MCC(btn) {
            console.log("MouseX:", mouseX, "MouseY:", mouseY); // debugging line
            console.log("btn:", btn);
            return (mouseX >= btn.x && mouseX <= (btn.x + btn.width) && mouseY >= btn.y && mouseY <= (btn.y + btn.height));
        };
        function PlayerHitbox(wall) { // <!-- TODO Fix hitbox
          if (isPlaying === true) {
            var Hitbox = {
              x: mouseX - 20,
              y: mouseY - 20,
              width: 40,
              height: 45,
            }
            noFill()
            rect(Hitbox.x, Hitbox.y, Hitbox.width, Hitbox.height);
            console.log(Hitbox.x, Hitbox.y) // Make sure this prints to console if char does not load
            if (Hitbox.x + Hitbox.width >= wall.x && Hitbox.y + Hitbox.height >= wall.y && Hitbox.x <= (wall.x + wall.width) && Hitbox.y <= (wall.y + wall.height)) {
              console.log("Hit detected on", wall)
              gameend();
            } else if (scene === 3 && Hitbox.x >= 250 && Hitbox.y >= 0 && Hitbox.x <= (250 + 150) && Hitbox.y <= (0 + 100)) {  //<!-- TODO Fix win detection. It is not working because win is not a parameter, but if you add it then the function does not work
              console.log("Win detected")
              level2();
              console.log(scene)
              timer = timer + 6
            };
        };
      };
        // The function that draws stuff
        draw = function() {
          if (isPlaying === true) {
            //Draws level and player
            levelLoad() // This puts a bandaid on the draw function
            imageMode(CENTER);
            image(img, mouseX, mouseY, 50, 50);
            // Timer Function
            Timers()
          };
        };
        function Timers() {
          timer = timer - 1/60
          fill(255)
          text(timer, 50, 25)
          PlayerDeath()
        };
        // Make sure u die
        function PlayerDeath() {
          if (isPlaying === true) {
            if (health <= 0 || timer <= 0) {
              isPlaying = false;
              gameend();
            };
          };
        };
          // Dead Screen
        function gameend() {
          console.log("Game Over")
          background(0)
          isPlaying = false;
          scene = 666;
          background(0, 0, 0);
          textSize(75);
          fill(255, 0, 0);
          textAlign(LEFT, TOP)
          text("You Died", 250, 350);
          textSize(45);
          text("Try Again?", 300, 450);
          btnGen(b2);
          btnGen(b3);
          if (MCC(b2)) {
            level1();
            isPlaying = true;
            health = 1;
            timer = initTimer;
          } if (MCC(b3)) {
            location.reload()
            isPlaying = false;
          };
        };

        // <!-- TODO Make the level system work dynamically. Increment the level when the player passes the win box and return it to the draw function
        function levelLoad() {
          if (scene === 3 && isPlaying === true) {
            level1();
          } if (scene === 4 && isPlaying === true) {
            level2();
          } if (scene === 5 && isPlaying === true) {
            level3();
          } if (scene === 6 && isPlaying === true) {
            level4();
          } if (scene === 7 && isPlaying === true) {
            level5();
          } if (scene === 8 && isPlaying === true) {
            level6();
        }
      };
          // Game level 1 and walls & winbox

        function level1() {
          scene = 3;
          background(98, 98, 98);
          walls(Aw1); walls(Aw2); walls(Aw3); walls(Aw4); walls(Aw5); walls(Aw6);
          winbox(win1);
          PlayerHitbox(Aw1); PlayerHitbox(Aw2); PlayerHitbox(Aw3); PlayerHitbox(Aw4); PlayerHitbox(Aw5); PlayerHitbox(Aw6);
        };
          // Level 1 walls <!-- ! MAKE SURE THERE ARE NO NEGATIVE VALUES IN THE WALLS
        var Aw1 = {
          x: 0,
          y: 0,
          width: 250,
          height: 100,
        };
        var Aw2 = {
          x: 0,
          y: 400,
          width: 700,
          height: 150,
        };
        var Aw3 = {
          x: 500,
          y: 690,
          width: 900,
          height: 300,
        };
        var Aw4 = {
          x: 0,
          y: 400,
          width: 250,
          height: 500,
        };
        var Aw5 = {
          x: 200,
          y: 200,
          width: 630,
          height: 100,
        };
        var Aw6 = {
          x: 400,
          y: 0,
          width: 800,
          height: 200,
        };
        var win1 = {
          x: 250,
          y: 0,
          width: 150,
          height: 100,
          rounding: 0,
        };

        // Level 2 walls & winbox
        function level2() {
          scene = 4;
          background(98, 98, 98);
          walls(Bw1); walls(Bw2); walls(Bw3); walls(Bw4); walls(Bw5); walls(Bw6);
          winbox(win2);
          PlayerHitbox(Bw1); PlayerHitbox(Bw2); PlayerHitbox(Bw3); PlayerHitbox(Bw4); PlayerHitbox(Bw5); PlayerHitbox(Bw6);
        };
        var Bw1 = {
          x: 0,
          y: 0,
          width: 250,
          height: 410,
        };
        var Bw2 = {
          x: 0,
          y: 350,
          width: 650,
          height: 100,
        };
        var Bw3 = {
          x: 400,
          y: 0,
          width: 150,
          height: 250,
        };
        var Bw4 = {
          x: 650,
          y: 100,
          width: 100,
          height: 350,
        };
        var Bw5 = {
          x: 100,
          y: 500,
          width: 800,
          height: 100,
        };
        var Bw6 = {
          x: 0,
          y: 650,
          width: 800,
          height: 400,
        };
        var win2 = {
          x: 760,
          y: 600,
          width: 150,
          height: 50,
        };
//<!-- !  LOOK HERE IF YOU ACCIDENTALLY ENTERED A LEVEL --!>
       GSetup(); //<!--  ! Change this to Setup(); , in case you see anything other than Setup() here. --!>
      };
    };
      //  GENERAL NOTES 1. NAMING CONVENTIONS
      // Naming convention is as follows: if you see an A, B, C, or D in from of the letter w, it is to indicate the level where the wall is location. For example, wall Aw1 is in level 1, wall Bw1 is in level 2, and so on.
      // Abnormally high number such as 666 and 999 indicate special scenes, that the player would not normally see if they were in a perfect playthrough. However, scene 666 is an intended part of the game while scene 999 is not.
      // 2. FUNCTIONS
      // MCC stands for Mouse Clicked Check. It is a function that checks if the mouse is clicked within the bounds of a button. Used for scene changes. SYNTAX: MCC(b1)
      // Setup should ALWAYS be the first scene displayed.
      // Level1 is called via the start button.
      // Walls is a specific function to draw walls, it is different than the other by setting the health to 0 when the player collides with it. SYNTAX: walls(Aw1); where Aw1 is the name of the wall.
      // Winbox is a specific function to draw the box that will load the next level. SYNTAX: winbox(win1); where win1 is the name of the winbox.
      // btngen is a function that generates a button. SYNTAX: btngen(1, 100, 100, 100, 100, "Start"); where 1 is the button number, 100 is the x position, 100 is the y position, 100 is the width, 100 is the height, and "Start" is the text on the button.
      // 3. SCENES & THEIR CORRESPONDING DRAWINGS
      // Scene 0 = Loading Screen
      // Scene 1 = Title Screen
      // Scene 2 = Tutorial
      // Scene 3 = Level 1
      // Scene 666 = Game Over
      // Scene 999 = Win Screen
      // 4. VARIABLES
      // 4a. Walls Aw1 through Aw6 are level 1 walls
      // 4B. Buttons
      // Btn 1 is the "Start" button
      // Btn 2 is the "Try Again" button
      // Btn 3 is the "Title Screen" button
      // Btn 999A is the tutorial button
      // Btn 999B is the level 2 button
    var canvas = document.getElementById("mycanvas"); 
    var processingInstance = new Processing(canvas, programCode); 
  </script>
</html>
